---
- name: Update APT and download OpenJDK 11 packages
  hosts: all 
  become: true
  tasks:
    - name: Ensure apt cache is updated
      apt:
        update_cache: yes
        cache_valid_time: 3600  # optional: only update if older than 1 hour

    - name: Create directory for OpenJDK 11 JDK .deb files
      file:
        path: /home/bastion/openjdk-11-jdk
        state: directory
        owner: bastion
        group: bastion
        mode: '0755'

    - name: Create directory for OpenJDK 11 JRE .deb files
      file:
        path: /home/bastion/openjdk-11-jre
        state: directory
        owner: bastion
        group: bastion
        mode: '0755'
        
    - name: Download .deb files
      shell: |
        cd /home/bastion/openjdk-11-jdk && \
        apt-get download $(apt-cache depends --recurse --no-recommends --no-suggests \
          --no-conflicts --no-breaks --no-replaces --no-enhances \
          --no-pre-depends openjdk-11-jdk | grep '^\w') && \
        cd /home/bastion/openjdk-11-jre && \
        apt-get download $(apt-cache depends --recurse --no-recommends --no-suggests \
          --no-conflicts --no-breaks --no-replaces --no-enhances \   
          --no-pre-depends openjdk-11-jre | grep "^\w")
      args:
        executable: /bin/bash
      environment:
        DEBIAN_FRONTEND: noninteractive
